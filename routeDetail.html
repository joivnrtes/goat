<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- ÈíàÂØπiPhoneÁöÑÂàùÂßãËßÜÂè£ÈÖçÁΩÆÔºåÁ¶ÅÊ≠¢Áî®Êà∑Áº©Êîæ‰ª•Ëé∑ÂæóÁ±ª‰ººÂéüÁîüAppÁöÑ‰ΩìÈ™å -->
  <meta
    name="viewport"
    content="width=device-width, maximum-scale=1.0, user-scalable=no"
  />
  <title>Á∫øË∑ØËØ¶ÊÉÖ</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC",
        "Segoe UI", Roboto, sans-serif;
      background: #f8f8f8;
      color: #333;
      box-sizing: border-box;
    }
    .header {
      background: rgba(130, 165, 223, 0.85);
      color: #fff;
      padding: 12px;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      display: flex;      /* Êñ∞Â¢û: ËÆ©ÂÆÉËÉΩÊ®™ÂêëÊéí */
      align-items: center; /* ÂûÇÁõ¥Â±Ö‰∏≠ */
    }
    .btn-back {
      background: transparent;
      border: none;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      margin-right: 10px;
    }
    .btn-back:hover {
      color: #eee;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      padding: 10px;
      min-height: calc(100vh - 20px);
    }
    .route-info h2 {
      margin: 0;
      font-size: 20px;
      margin-bottom: 6px;
    }
    .route-meta {
      font-size: 13px;
      color: #999;
      margin-bottom: 8px;
    }
    .route-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .btn-like-route {
      background: transparent;
      border: none;
      color: #f04e30;
      cursor: pointer;
      font-size: 16px;
    }
    .btn-like-route:hover {
      color: #d13e27;
    }
    .like-count {
      font-size: 14px;
      color: #555;
    }
    .route-comment {
      margin: 6px 0;
      font-size: 14px;
      color: #555;
      white-space: pre-wrap;
    }
    .route-video {
      font-size: 14px;
      color: #5690d8;
      text-decoration: underline;
      cursor: pointer;
    }
    .route-video:hover {
      color: #f04e30;
    }

    /* ËØÑËÆ∫Âå∫ */
    .comment-section {
      margin-top: 12px;
      border-top: 1px solid #eee;
      padding-top: 10px;
    }
    .comment-section h3 {
      margin: 0 0 10px;
      font-size: 16px;
    }
    .comment-item {
      margin-bottom: 10px;
      padding: 8px;
      background: #fafafa;
      border-radius: 4px;
      border: 1px solid #eee;
      position: relative;
    }
    .comment-item-text {
      font-size: 14px;
      color: #333;
      white-space: pre-wrap;
    }
    .comment-item-video {
      font-size: 13px;
      color: #5690d8;
      text-decoration: underline;
      cursor: pointer;
      display: block;
      margin-top: 4px;
    }
    .comment-item-video:hover {
      color: #f04e30;
    }
    .btn-delete-comment {
      background: #aaa;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 2px 8px;
      font-size: 12px;
      cursor: pointer;
      position: absolute;
      top: 8px;
      right: 8px;
    }
    .btn-delete-comment:hover {
      background: #888;
    }

    .comment-form {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .comment-form textarea,
    .comment-form input {
      width: 100%;
      box-sizing: border-box;
      font-size: 14px;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .btn-submit-comment {
      background: #5690d8;
      color: #fff;
      border: none;
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 4px;
      width: 80px;
      text-align: center;
    }
    .btn-submit-comment:hover {
      background: #4577b5;
    }
  </style>
</head>
<body>
  <!-- Â§¥ÈÉ®ÔºöÂ¢ûÂä†ËøîÂõûÊåâÈíÆ -->
  <div class="header">
    <button class="btn-back" onclick="goBackToGymDetail()">‚Üê</button>
    Á∫øË∑ØËØ¶ÊÉÖ
  </div>

  <div class="container">
    <div class="route-info">
      <h2 id="route-title">Á∫øË∑ØÂêçÁß∞(Âä®ÊÄÅ)</h2>
      <p class="route-meta" id="route-meta"></p>
    </div>
    <div class="route-actions">
      <button class="btn-like-route" id="btn-like-route">üëç</button>
      <span class="like-count" id="route-like">0Ëµû</span>
    </div>

    <div class="route-comment" id="route-comment"></div>
    <a class="route-video" id="route-video" href="#" target="_blank"></a>

    <!-- ËØÑËÆ∫Âå∫ -->
    <div class="comment-section">
      <h3>ËØÑËÆ∫Âå∫</h3>
      <div id="comment-list"></div>
      <!-- Ê∑ªÂä†ËØÑËÆ∫Ë°®Âçï -->
      <div class="comment-form">
        <textarea id="cmt-text" rows="3" placeholder="ÂÜôÁÇπ‰ªÄ‰πà..."></textarea>
        <input type="text" id="cmt-video" placeholder="ËßÜÈ¢ëBetaÈìæÊé•(ÂèØÈÄâ)"/>
        <button class="btn-submit-comment" onclick="addComment()">ÂèëÂ∏É</button>
      </div>
    </div>
  </div>

  <script>
    // ========== Êñ∞Â¢ûÔºöËøîÂõûÂà∞gymdetail.html ==========
    function goBackToGymDetail() {
      window.location.href = "gymdetail.html"; 
      // ÊàñËÄÖ: history.back()
    }

    // ‰∏∫ÁÆÄÂåñÊºîÁ§∫ÔºåËøôÈáå‰πüÊú¨Âú∞Â≠òÂÇ®Á∫øË∑Ø‰ø°ÊÅØ
    // Âú®ÁúüÊ≠£ÁéØÂ¢É‰∏ãÔºå‰Ω†ÂèØÂú® beijingAA.html -> routeDetail.html ÈÄöËøáÂêéÁ´ØÊé•Âè£Ëé∑ÂèñÂÆåÊï¥‰ø°ÊÅØ
    // ËøôÈáåÁî®‰∏Ä‰∏™ÂÖ®Â±Ä routesDetail Êù•Ê®°Êãü
    const routesDetail = {
      101: {
        id: 101,
        name: "ËìùËâ≤5.10a",
        difficulty: "5.10a",
        creator: "Áî®Êà∑Alice",
        likeCount: 3,
        comment: "ÈúÄË¶ÅÂ§ßË∑®Ê≠•ÔºåÊ≥®ÊÑèÊ†∏ÂøÉÂèëÂäõ„ÄÇ",
        video: "http://example.com/video.mp4",
        comments: [
          { id: 5001, text: "Êàë‰πüÁà¨‰∫ÜÔºåÂ•ΩÈÖ∏ÊâãÔºÅ", video:"", user: "Áî®Êà∑Bob" },
          { id: 5002, text: "Êúâ‰∏™Â∞èBetaÂàÜ‰∫´", video:"http://beta.com/betaA", user: "Áî®Êà∑Chris" }
        ]
      },
      102: {
        id: 102,
        name: "Á∫¢Ëâ≤5.10c",
        difficulty: "5.10c",
        creator: "Áî®Êà∑Bob",
        likeCount: 5,
        comment: "Êúâ‰∏™ÊñúÊ•î‰ΩçÈúÄË¶ÅÁî®ËÑöÂ∞ñÂç°‰Ωè„ÄÇ",
        video: "",
        comments: [
          { id: 6001, text: "ÊúÄÂêéÈ°∂ÁÇπÂæàÊçèÊâã", video:"", user: "Áî®Êà∑Alice" },
          { id: 6002, text: "ÊàëÁöÑBetaÈìæÊé•", video:"http://beta.com/betaB", user: "Áî®Êà∑Chris" }
        ]
      },
      103: {
        id: 103,
        name: "ÈªÑËâ≤v3",
        difficulty: "v3",
        creator: "Áî®Êà∑Charlie",
        likeCount: 2,
        comment: "Êä±Áü≥Á∫øË∑ØÔºåÈúÄË¶ÅÊ†∏ÂøÉÁàÜÂèë„ÄÇ",
        video: "",
        comments: [
          { id: 7001, text: "ÊÑüËßâÊØîv3ÈöæÂïä", video:"", user: "Áî®Êà∑Bob" }
        ]
      }
    };

    let currentRoute = null; // ‰øùÂ≠òÂΩìÂâçÁ∫øË∑ØËØ¶ÁªÜ‰ø°ÊÅØ

    window.addEventListener('DOMContentLoaded', () => {
      // Ëß£ÊûêURLÈáåÁöÑ ?id=xxx
      const params = new URLSearchParams(window.location.search);
      const routeId = parseInt(params.get('id'),10);
      currentRoute = routesDetail[routeId];

      // Ê∏≤ÊüìÁ∫øË∑Ø‰ø°ÊÅØ
      document.getElementById('route-title').textContent 
        = `${currentRoute.name} - ${currentRoute.difficulty}`;
      document.getElementById('route-meta').textContent 
        = `ÂàõÂª∫ËÄÖ: ${currentRoute.creator}`;
      document.getElementById('route-like').textContent 
        = `${currentRoute.likeCount}Ëµû`;
      document.getElementById('route-comment').textContent 
        = currentRoute.comment || "(ÊöÇÊó†ÊèèËø∞)";

      const videoA = document.getElementById('route-video');
      if(currentRoute.video){
        videoA.textContent = "Êü•ÁúãËßÜÈ¢ëBeta";
        videoA.href = currentRoute.video;
      } else {
        videoA.textContent = "";
        videoA.removeAttribute('href');
      }

      // ÁÇπËµûÊåâÈíÆ
      document.getElementById('btn-like-route').onclick = () => {
        currentRoute.likeCount++;
        document.getElementById('route-like').textContent 
          = `${currentRoute.likeCount}Ëµû`;
      };

      // Ê∏≤ÊüìËØÑËÆ∫ÂàóË°®
      renderCommentList();
    });

    function renderCommentList(){
      const listEl = document.getElementById('comment-list');
      listEl.innerHTML = "";

      currentRoute.comments.forEach(cmt => {
        const cItem = document.createElement('div');
        cItem.className = "comment-item";

        const textDiv = document.createElement('div');
        textDiv.className = "comment-item-text";
        textDiv.textContent = `${cmt.user || "ÂåøÂêç"}: ${cmt.text || "(Êó†ÊñáÂ≠ó)"}`;

        cItem.appendChild(textDiv);

        if(cmt.video){
          const vidA = document.createElement('a');
          vidA.className = "comment-item-video";
          vidA.href = cmt.video;
          vidA.target = "_blank";
          vidA.textContent = "Êü•ÁúãËßÜÈ¢ëBeta";
          cItem.appendChild(vidA);
        }

        const delBtn = document.createElement('button');
        delBtn.className = "btn-delete-comment";
        delBtn.textContent = "Âà†";
        delBtn.onclick = () => {
          deleteComment(cmt.id);
        };
        cItem.appendChild(delBtn);

        listEl.appendChild(cItem);
      });
    }

    function addComment(){
      const txt = document.getElementById('cmt-text').value.trim();
      const vid = document.getElementById('cmt-video').value.trim();
      if(!txt && !vid){
        alert("ËØ∑Ëá≥Â∞ëÂ°´ÂÜôÊñáÂ≠óÊàñËßÜÈ¢ëÈìæÊé•");
        return;
      }
      // ÂÅáËÆæÂΩìÂâçÁî®Êà∑Âè´‚ÄúÁî®Êà∑You‚Äù
      const newId = Date.now(); // ÁÆÄÊòìid
      currentRoute.comments.push({
        id: newId,
        text: txt,
        video: vid,
        user: "Áî®Êà∑You"
      });
      document.getElementById('cmt-text').value = "";
      document.getElementById('cmt-video').value = "";
      renderCommentList();
    }

    function deleteComment(commentId){
      if(!confirm("Á°ÆÂÆöÂà†Èô§ËØ•Êù°ËØÑËÆ∫ÂêóÔºü")) return;
      currentRoute.comments = currentRoute.comments.filter(c => c.id !== commentId);
      renderCommentList();
    }
  </script>
</body>
</html>
